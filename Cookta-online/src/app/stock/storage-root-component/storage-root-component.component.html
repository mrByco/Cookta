<div class="container-fluid">
  <div class="row"
       style="background: #ac4c00 url('../../../assets/background/storage-background.jpg') no-repeat center; background-size: cover;">
    <div class="col-md"></div>
    <div class="col-md-9 storage-panel d-flex flex-column">
      <div class="storage-search row">
        <div class="col-sm-4">
          <input type="text" placeholder="Keresés (hamarosan)" [(ngModel)]="SearchText">
        </div>
        <div class="col-sm-2 p-0">
          <button class="storage-header-btn" (click)="ShowAddModal()">Vásároltam</button>
        </div>
        <div class="col-sm-2 p-0">
          <button class="storage-header-btn" (click)="RemoveIngModal.show()">Felbontottam</button>
        </div>
        <div class="col-sm-2 p-0">
          <button class="storage-header-btn" routerLink="/stocker">Leltárazás</button>
        </div>
        <div class="col-sm-2 p-0">
          <button class="storage-header-btn" (click)="AddNewSection()">Új tároló</button>
        </div>
      </div>
      <div class="flex-grow-1" style="overflow: auto">
        <mat-tab-group (selectedIndexChange)="SelectedChange()" #group color="accent"  style="height: inherit">
          <mat-tab [label]="section.GetDisplayName()" *ngFor="let section of stockService.Sections; let i = index">
            <app-storage-section
                    [SelectedItems]="SelectedItems" [SearchResults]="i == 0 ? SearchResults : []" [CurrentSection]="section"></app-storage-section>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
    <div class="col-md"></div>
  </div>
</div>

<div mdbModal #AddIngModal class="modal fade modal-full top" tabindex="-1" role="dialog" aria-hidden="true" (onShown)="ingredientAdder.Focus()"
     [config]="{backdrop: false, ignoreBackdropClick: true}">
  <div class="modal-dialog modal-top" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close pull-right" aria-label="Close" (click)="AddIngModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title w-100" id="addIngTitle">Mit vettél?</h4>
      </div>
      <div class="modal-body">
        <app-ingredient-adder-seamless
          #ingredientAdder
          [ShowTitleOnReady]="false"
          (OnIngredientAdded)="AddIngredientToSection($event)">
        </app-ingredient-adder-seamless>
        <hr>
        <p *ngIf="ingredientAdder.CurrentState == 2">Enterrel bepakolhatod</p>
        <a *ngIf="ingredientAdder.CurrentState == 2 && ingredientAdder.CurrentType != null &&
             stockService.FindStorageByIngredientType(ingredientAdder.CurrentType.guid) &&
             ingredientAdder.CurrentType != null && stockService.FindStorageByIngredientType(ingredientAdder.CurrentType.guid) != SelectedSection"
           (click)="SelectedSection = ingredientAdder.CurrentType != null && stockService.FindStorageByIngredientType(ingredientAdder.CurrentType.guid)"
           style="color: red; margin-bottom: 1rem">
          Ez már be van
          írva: {{stockService.FindStorageByIngredientType(ingredientAdder.CurrentType.guid).GetDisplayName()}}
          tárolóba,
          kattints ide átváltáshoz
        </a>
        <div class="row">
          <div class="col-auto">
            <h6 style="margin-top: 10px">Pakolás helye: </h6>
          </div>
          <div class="col">
            <select class="browser-default custom-select " style="width: 100%"
                    [(ngModel)]="this.SelectedSection">
              <option *ngFor="let section of stockService.Sections"
                      [selected]="SelectedSection == section"
                      [ngValue]="section">
                {{section.GetDisplayName()}}
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div mdbModal #RemoveIngModal class="modal fade top" tabindex="-1" role="dialog" aria-hidden="true"
     [config]="{backdrop: true, ignoreBackdropClick: true}">
  <div class="modal-dialog modal-top" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close pull-right" aria-label="Close" (click)="RemoveIngModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title w-100" id="removeIngTitle">Mit bontottál ki?</h4>
      </div>
      <div class="modal-body">
        <app-ingredient-adder
          [ShowAddButton]="false"
          #IngredientRemover
          (OnIngredientChangedProgrammatically)="CloseIfIngredientIsZero($event, RemoveIngModal)"
          (OnIngredientAdded)="AddIngredientToSection($event)">
        </app-ingredient-adder>
        <hr>
        <div *ngIf="IngredientRemover.Done">
          <div *ngFor="let section of findStorageSectionsByType(IngredientRemover.CurrentType.guid)"
               style="position: static">
            <div class="row" *ngFor="let ing of section.filterItemsByIngId(IngredientRemover.CurrentType)"
                 style="position: static">
              <div class="col-8">
                {{section.GetDisplayName()}}
              </div>
              <div class="col-auto mx-0 px-0">
                {{ing.value}}
              </div>
              <div class="col mx-0 px-0">
                {{unitService.GetDisplayName(ing.unit)}}
              </div>
              <div class="col-2 mr-3">
                <a
                  (click)="IngredientRemover.Ingredient = stockService.SubtractIngredientFromSection(IngredientRemover.Ingredient, section, true)"
                  class="take-off">Levon</a>
              </div>
            </div>
          </div>
          <div *ngIf="findStorageSectionsByType(IngredientRemover.CurrentType.guid).length == 0">
            <p>Nincs fajta hozzávaló a kamrában, így nem tudod levonni.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



